"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3334],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return k}});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=l.createContext({}),u=function(e){var t=l.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return l.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},g=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),g=u(n),k=a,c=g["".concat(p,".").concat(k)]||g[k]||s[k]||r;return n?l.createElement(c,i(i({ref:t},d),{},{components:n})):l.createElement(c,i({ref:t},d))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=g;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var u=2;u<r;u++)i[u]=n[u];return l.createElement.apply(null,i)}return l.createElement.apply(null,n)}g.displayName="MDXCreateElement"},5483:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return d},default:function(){return g}});var l=n(3117),a=n(102),r=(n(7294),n(3905)),i=["components"],o={title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",order:2},p=void 0,u={unversionedId:"plugin/develop/build",id:"plugin/develop/build",title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",description:"\u63d2\u4ef6\u5de5\u7a0b\u80fd\u529b\u901a\u8fc7 src/index.ts \u5b9a\u4e49\uff0c\u7ed3\u6784\u5982\u4e0b",source:"@site/docs/plugin/develop/build.md",sourceDirName:"plugin/develop",slug:"/plugin/develop/build",permalink:"/docs/plugin/develop/build",editUrl:"https://github.com/ice-lab/site/edit/master/docs/plugin/develop/build.md",tags:[],version:"current",frontMatter:{title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",order:2},sidebar:"plugin",previous:{title:"\u63d2\u4ef6\u5f00\u53d1\u6307\u5357",permalink:"/docs/plugin/develop/start"},next:{title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u8fd0\u884c\u65f6\u80fd\u529b",permalink:"/docs/plugin/develop/runtime"}},d=[{value:"\u63d2\u4ef6 API",id:"\u63d2\u4ef6-api",children:[{value:"context",id:"context",children:[],level:3},{value:"onGetWebpackConfig",id:"ongetwebpackconfig",children:[],level:3},{value:"onGetJestConfig",id:"ongetjestconfig",children:[],level:3},{value:"onHook",id:"onhook",children:[{value:"start \u547d\u4ee4",id:"start-\u547d\u4ee4",children:[],level:4},{value:"build \u547d\u4ee4",id:"build-\u547d\u4ee4",children:[],level:4},{value:"test \u547d\u4ee4",id:"test-\u547d\u4ee4",children:[],level:4}],level:3},{value:"log",id:"log",children:[],level:3},{value:"registerUserConfig",id:"registeruserconfig",children:[],level:3},{value:"registerClioption",id:"registerclioption",children:[],level:3},{value:"registerMethod",id:"registermethod",children:[],level:3},{value:"modifyUserConfig",id:"modifyuserconfig",children:[],level:3},{value:"registerTask",id:"registertask",children:[],level:3},{value:"getAllTask",id:"getalltask",children:[],level:3},{value:"getAllPlugin",id:"getallplugin",children:[],level:3}],level:2},{value:"\u6269\u5c55 API",id:"\u6269\u5c55-api",children:[{value:"addPluginTemplate",id:"addplugintemplate",children:[],level:3},{value:"addRenderFile",id:"addrenderfile",children:[],level:3},{value:"addExport",id:"addexport",children:[],level:3},{value:"addAppConfigTypes",id:"addappconfigtypes",children:[],level:3},{value:"getPages",id:"getpages",children:[],level:3},{value:"addDisableRuntimePlugin",id:"adddisableruntimeplugin",children:[],level:3},{value:"watchFileChange",id:"watchfilechange",children:[],level:3}],level:2},{value:"\u63d2\u4ef6\u53c2\u6570",id:"\u63d2\u4ef6\u53c2\u6570",children:[],level:2},{value:"\u63d2\u4ef6\u901a\u4fe1",id:"\u63d2\u4ef6\u901a\u4fe1",children:[{value:"setValue",id:"setvalue",children:[],level:3},{value:"getValue",id:"getvalue",children:[],level:3}],level:2},{value:"\u7c7b\u578b",id:"\u7c7b\u578b",children:[],level:2}],s={toc:d};function g(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,l.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u63d2\u4ef6\u5de5\u7a0b\u80fd\u529b\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"src/index.ts")," \u5b9a\u4e49\uff0c\u7ed3\u6784\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({ context, onGetWebpackConfig, log, onHook, ...rest }, options) => {\n  // \u7b2c\u4e00\u9879\u53c2\u6570\u4e3a\u63d2\u4ef6 API \u63d0\u4f9b\u7684\u80fd\u529b\n  // options\uff1a\u63d2\u4ef6\u81ea\u5b9a\u4e49\u53c2\u6570\n};\n")),(0,r.kt)("p",null,"\u8be5\u65b9\u6cd5\u4f1a\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u63d2\u4ef6\u63d0\u4f9b\u7684 API \u63a5\u53e3\uff0c\u63a8\u8350\u6309\u7167\u89e3\u6784\u65b9\u5f0f\u4f7f\u7528\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"options"),"\xa0\u662f\u63d2\u4ef6\u81ea\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u7531\u63d2\u4ef6\u5f00\u53d1\u8005\u51b3\u5b9a\u63d0\u4f9b\u54ea\u4e9b\u9009\u9879\u7ed9\u7528\u6237\u914d\u7f6e\u3002"),(0,r.kt)("h2",{id:"\u63d2\u4ef6-api"},"\u63d2\u4ef6 API"),(0,r.kt)("p",null,"\u901a\u8fc7\u63d2\u4ef6\u63d0\u4f9b\u7684 API\uff0c\u53ef\u4ee5\u65b9\u4fbf\u62d3\u5c55\u548c\u81ea\u5b9a\u4e49\u80fd\u529b\u3002"),(0,r.kt)("h3",{id:"context"},"context"),(0,r.kt)("p",null,"\u5305\u542b\u8fd0\u884c\u65f6\u7684\u5404\u79cd\u73af\u5883\u4fe1\u606f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"command")," \u5f53\u524d\u8fd0\u884c\u547d\u4ee4\uff0cstart/build/test"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"commandArgs")," script \u547d\u4ee4\u6267\u884c\u65f6\u63a5\u53d7\u5230\u7684\u53c2\u6570"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rootDir")," \u9879\u76ee\u6839\u76ee\u5f55"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"userConfig")," \u7528\u6237\u5728 build.json \u4e2d\u914d\u7f6e\u7684\u5185\u5bb9"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pkg")," \u9879\u76ee package.json \u4e2d\u7684\u5185\u5bb9")),(0,r.kt)("h3",{id:"ongetwebpackconfig"},"onGetWebpackConfig"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"onGetWebpackConfig")," \u83b7\u53d6 webpack-chain \u5f62\u5f0f\u7684\u914d\u7f6e\uff0c\u5e76\u5bf9\u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u4fee\u6539\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({onGetWebpackConfig, registerTask}) => {\n  registerTask('default', webpackConfig);\n\n  onGetWebpackConfig((config) => {\n    config.entry('xxx');\n  });\n}\n")),(0,r.kt)("h3",{id:"ongetjestconfig"},"onGetJestConfig"),(0,r.kt)("p",null,"\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"onGetJestConfig")," \u83b7\u53d6 jest \u914d\u7f6e\uff0c\u53ef\u5bf9\u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u4fee\u6539\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({onGetJestConfig}) => {\n  onGetJestConfig((jestConfig) => {\n    const modifiedJestConfig = modify(jestConfig);\n      return modifiedJestConfig;\n  });\n};\n")),(0,r.kt)("h3",{id:"onhook"},"onHook"),(0,r.kt)("p",null,"\u901a\u8fc7 onHook \u76d1\u542c\u547d\u4ee4\u8fd0\u884c\u65f6\u4e8b\u4ef6\uff0conHook \u6ce8\u518c\u7684\u51fd\u6570\u6267\u884c\u5b8c\u6210\u540e\u624d\u4f1a\u6267\u884c\u540e\u7eed\u64cd\u4f5c\uff0c\u53ef\u4ee5\u7528\u4e8e\u5728\u547d\u4ee4\u8fd0\u884c\u4e2d\u9014\u63d2\u5165\u63d2\u4ef6\u60f3\u505a\u7684\u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({ onHook }) => {\n onHook('before.build.load', () => {\n   // do something before dev\n });\n onHook('after.build.compile', (stats) => {\n   // do something after build\n });\n}\n")),(0,r.kt)("p",null,"\u76ee\u524d\u652f\u6301\u7684\u547d\u4ee4\u6267\u884c\u751f\u547d\u5468\u671f\u5982\u4e0b\uff1a"),(0,r.kt)("h4",{id:"start-\u547d\u4ee4"},"start \u547d\u4ee4"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,r.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.start.load"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 args: CommandArgs, // \u542f\u52a8\u53c2\u6570",(0,r.kt)("br",null)," webpackConfig: ConfigInfo[]",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u8f6c\u5316\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.start.run"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 args: CommandArgs, // \u542f\u52a8\u53c2\u6570",(0,r.kt)("br",null)," config: WebpackConfig[]",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6784\u5efa\u6267\u884c\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"after.start.compile"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0\xa0url: string // serverUrl, ",(0,r.kt)("br",null),"isFirstCompile: boolean,",(0,r.kt)("br",null),"\xa0 stats: WebpackAssets // Vite \u6a21\u5f0f\u4e0b\u4e0d\u5b58\u5728 stats",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7f16\u8bd1\u7ed3\u675f\uff0c\u6bcf\u6b21\u91cd\u65b0\u7f16\u8bd1\u90fd\u4f1a\u6267\u884c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.start.devServer"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 url: string // serverUrl,",(0,r.kt)("br",null),"\xa0devServer:\xa0\xa0WebpackDevServer"),(0,r.kt)("td",{parentName:"tr",align:null},"viteServer",(0,r.kt)("br",null),"}")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"after.start.devServer"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 url: string // serverUrl,",(0,r.kt)("br",null),"\xa0 devServer: WebpackDevServer \uff5c viteServer,",(0,r.kt)("br",null),"\xa0 err: Error",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"dev server \u542f\u52a8\u540e\uff0c\u4ec5\u652f\u6301 Webpack \u6784\u5efa\u6a21\u5f0f")))),(0,r.kt)("h4",{id:"build-\u547d\u4ee4"},"build \u547d\u4ee4"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,r.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.build.load"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 args: CommandArgs, // \u542f\u52a8\u53c2\u6570",(0,r.kt)("br",null)," webpackConfig: ConfigInfo[]",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u914d\u7f6e\u8f6c\u5316\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.build.run"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 args: CommandArgs, // \u542f\u52a8\u53c2\u6570",(0,r.kt)("br",null)," config: WebpackConfig[]",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6784\u5efa\u6267\u884c\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"after.build.compile"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 err: Error,",(0,r.kt)("br",null),"\xa0 stats: WebpackAssets // Vite \u6a21\u5f0f\u4e0b\u4e0d\u5b58\u5728 stats",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6784\u5efa\u7ed3\u675f")))),(0,r.kt)("h4",{id:"test-\u547d\u4ee4"},"test \u547d\u4ee4"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,r.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.test.load"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 args: array // \u542f\u52a8\u53c2\u6570",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6 jest \u914d\u7f6e\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"before.test.run"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"jest \u6267\u884c\u4e4b\u524d")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"after.test"),(0,r.kt)("td",{parentName:"tr",align:null},"{",(0,r.kt)("br",null),"\xa0 result // jest\u6267\u884c\u7ed3\u679c",(0,r.kt)("br",null),"}"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6d4b\u8bd5\u547d\u4ee4\u6267\u884c\u7ed3\u675f")))),(0,r.kt)("h3",{id:"log"},"log"),(0,r.kt)("p",null,"\u7edf\u4e00\u7684 log \u5de5\u5177\uff0c\u5e95\u5c42\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"npmlog")," \uff0c\u4fbf\u4e8e\u751f\u6210\u7edf\u4e00\u683c\u5f0f\u7684 log\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"log.info('start');\nlog.verbose('debug');\nlog.error('exit');\n")),(0,r.kt)("h3",{id:"registeruserconfig"},"registerUserConfig"),(0,r.kt)("p",null,"\u4e3a\u7528\u6237\u914d\u7f6e\u6587\u4ef6 ",(0,r.kt)("inlineCode",{parentName:"p"},"build.json")," \u4e2d\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5b57\u6bb5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerUserConfig}) => {\n  registerUserConfig({\n    name: 'custom-key',\n    validation: 'boolean' // \u53ef\u9009\uff0c\u652f\u6301\u7c7b\u578b\u6709 string, number, array, object, boolean\n  });\n};\n")),(0,r.kt)("h3",{id:"registerclioption"},"registerClioption"),(0,r.kt)("p",null,"\u4e3a\u547d\u4ee4\u884c\u542f\u52a8\u6dfb\u52a0\u81ea\u5b9a\u4e49\u53c2\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerClioption}) => {\n  registerCliOption({\n    name: 'custom-option', // \u53c2\u6570\u540d\n    commands: ['start'], // \u547d\u4ee4\n    configWebpack: (arg) => {} // \u53ef\u9009\uff0carg \u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u5bf9\u5e94\u503c\n  });\n};\n")),(0,r.kt)("h3",{id:"registermethod"},"registerMethod"),(0,r.kt)("p",null,"\u6ce8\u518c\u81ea\u5b9a\u4e49\u65b9\u6cd5\u3002\u901a\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"p"},"applyMethod")," \u8c03\u7528\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerMethod}) => {\n  registerMethod(name, func); // name, func \u5206\u522b\u4e3a\u65b9\u6cd5\u540d\u548c\u65b9\u6cd5\n};\n")),(0,r.kt)("h3",{id:"modifyuserconfig"},"modifyUserConfig"),(0,r.kt)("p",null,"\u4fee\u6539\u7528\u6237\u914d\u7f6e\u6587\u4ef6\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({modifyUserConfig}) => {\n  modifyUserConfig(key, value); // key, value \u5206\u522b\u4e3a\u7528\u6237\u914d\u7f6e\u6587\u4ef6\u952e\u503c\u5bf9\n};\n")),(0,r.kt)("h3",{id:"registertask"},"registerTask"),(0,r.kt)("p",null,"\u6dfb\u52a0 Webpack \u914d\u7f6e\uff0c\u914d\u7f6e\u4e3a webpack-chain \u5f62\u5f0f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerTask}) => {\n  registerTask(name, config); // name: Task\u540d, config: webpack-chain \u5f62\u5f0f\u7684\u914d\u7f6e\n};\n")),(0,r.kt)("h3",{id:"getalltask"},"getAllTask"),(0,r.kt)("p",null,"\u83b7\u53d6\u6240\u6709 Webpack \u914d\u7f6e\u540d\u79f0\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getAllTask}) => {\n  const alltasks = getAlltask();\n};\n")),(0,r.kt)("h3",{id:"getallplugin"},"getAllPlugin"),(0,r.kt)("p",null,"\u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getAllPlugin}) => {\n  // \u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u6570\u7ec4\n  // \u7c7b\u578b\uff1a() => [{pluginPath, options, name}]\n  const plugins = getAllPlugin(); \uff0c[]\n}\n")),(0,r.kt)("h2",{id:"\u6269\u5c55-api"},"\u6269\u5c55 API"),(0,r.kt)("p",null,"\u9664\u4e86\u4ee5\u4e0a\u7531 build-scripts \u5185\u7f6e\u652f\u6301\u7684 API\uff0c\u6211\u4eec\u8fd8\u901a\u8fc7 icejs \u5bf9\u63d2\u4ef6 API \u505a\u4e86\u6269\u5c55\uff0c\u6269\u5c55\u7684 API \u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8c03\u7528\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ applyMethod }) => {\n  // \u7b2c\u4e00\u4e2a\u53c2\u6570\u5bf9\u5e94 API \u540d\u79f0\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5bf9\u5e94 API \u53c2\u6570\n  applyMethod('addIceExport', { source: `./config`, exportName });\n}\n")),(0,r.kt)("h3",{id:"addplugintemplate"},"addPluginTemplate"),(0,r.kt)("p",null,"\u4e3a\u8fd0\u884c\u65f6\u76ee\u5f55\u4e2d\u7684\u6a21\u7248\u751f\u6210\u63d0\u4f9b\u7edf\u4e00\u7684\u6e32\u67d3\u670d\u52a1\uff08\u76ee\u5f55\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// \u9ed8\u8ba4\u6e32\u67d3\u76ee\u5f55\u7531\u63d2\u4ef6\u540d\u79f0\u51b3\u5b9a\napplyMethod('addPluginTemplate', path.join(__dirname, '../template'));\n\n// \u6307\u5b9a\u6a21\u7248\u6e32\u67d3\u76ee\u5f55\nconst renderData = {}; // \u53ef\u9009\uff0cejs \u989d\u5916\u6e32\u67d3\u53c2\u6570\napplyMethod('addPluginTemplate', {\n  template: path.join(__dirname, '../src/types'),\n  targetDir: 'router/types',\n}, renderData);\n")),(0,r.kt)("h3",{id:"addrenderfile"},"addRenderFile"),(0,r.kt)("p",null,"\u5411\u8fd0\u884c\u65f6\u76ee\u5f55\u6dfb\u52a0\u63d0\u4f9b\u6587\u4ef6\u7684\u6e32\u67d3\u670d\u52a1\uff08\u6587\u4ef6\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const sourceFile = '../template/index.tsx.ejs');\nconst targetFile = path.join(runtimeDir, 'source/index.tsx');\nconst renderData = {}; // \u53ef\u9009\uff0cejs \u989d\u5916\u6e32\u67d3\u53c2\u6570\napplyMethod('addRenderFile', path.join(__dirname, sourceFile, targetFile, renderData);\n")),(0,r.kt)("h3",{id:"addexport"},"addExport"),(0,r.kt)("p",null,"\u5411 ",(0,r.kt)("inlineCode",{parentName:"p"},"ice")," \u91cc\u6ce8\u518c\u6a21\u5757\uff0c\u5b9e\u73b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"import { foo } from 'ice';")," \u7684\u80fd\u529b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"\n// API \u53c2\u6570\n// source: \u6307\u5b9a\u5bfc\u51fa\u6a21\u5757\u5f15\u5165\u7684\u6587\u4ef6\u76ee\u5f55\n// exportName: \u4ece ice \u4e2d\u5bfc\u51fa\u7684\u6a21\u5757\u540d\u79f0\u3002\n// specifier: \u4ece source \u4e2d\u9ed8\u8ba4\u5bfc\u51fa\u65b9\u5f0f\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u503c\u4e3a default export\uff0c\u5982\u679c\u4e3a named export \u9700\u8981\u989d\u5916\u8bbe\u7f6e\n//\n// \u5b9e\u73b0 import { request } from 'ice'; request \u7531\u63d2\u4ef6\u7684 `./request/request` \u6587\u4ef6\u5b9e\u73b0\napplyMethod('addExport', { source: './request/request', exportName: 'request' })\n")),(0,r.kt)("h3",{id:"addappconfigtypes"},"addAppConfigTypes"),(0,r.kt)("p",null,"\u5411 appConfig \u6dfb\u52a0\u7c7b\u578b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u7b2c\u4e00\u9879\u53c2\u6570\u5bf9\u5e94 API \u540d\u79f0\uff0c\u7b2c\u4e8c\u9879\u53c2\u6570\u5bf9\u5e94 API \u53c2\u6570\u3002\n//\n// API \u53c2\u6570\uff1a\n// source: \u7c7b\u578b\u58f0\u660e\u6587\u4ef6\u3002./foo/types\uff0c\u5bf9\u5e94 ICE_TEMP_DIR/foo/types\u3002 ICE_TEMP_DIR\uff0c\u53ef\u901a\u8fc7 getValue('TEMP_PATH') \u83b7\u5f97\u3002\u6ce8\u610f\uff1a\u9700\u5148\u5c06\u5bf9\u5e94\u7c7b\u578b\u6587\u4ef6\u79fb\u81f3 ICE_TEMP_DIR\u3002\n// specifier: \u5bfc\u51fa\u7c7b\u578b\u6807\u8bc6\u7b26\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u503c\u4e3a '*'\u3002\n// exportName: \u6dfb\u52a0\u81f3 appConfig \u7c7b\u578b IAppConfig \u4e0a\u7684\u5bfc\u51fa\u540d\u3002\n//\n// \u7ed3\u679c\u4e3a\uff1a\n// // ICE_TEMP_DIR/types.ts\n// import { Foo } from './foo/types';\n// export interface IAppConfig {\n//   foo?: Foo\n// }\napplyMethod('addAppConfigTypes', { source: `./foo/types`, specifier: '{ Foo }', exportName: `foo?: Foo` });\n")),(0,r.kt)("h3",{id:"getpages"},"getPages"),(0,r.kt)("p",null,"\u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"src/pages")," \u4e0b\u7684\u4e00\u7ea7\u9875\u9762\u5217\u8868\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ['Home', 'About']\nconst pages = this.applyMethod('getPages', this.rootDir);\n")),(0,r.kt)("h3",{id:"adddisableruntimeplugin"},"addDisableRuntimePlugin"),(0,r.kt)("p",null,"\u7981\u7528\u63d2\u4ef6\u7684\u8fd0\u884c\u65f6\u80fd\u529b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// \u7981\u7528\u5185\u7f6e\u7684 request \u7684\u8fd0\u884c\u65f6\u80fd\u529b\napplyMethod('addDisableRuntimePlugin', 'build-plugin-ice-request');\n")),(0,r.kt)("h3",{id:"watchfilechange"},"watchFileChange"),(0,r.kt)("p",null,"\u76d1\u542c ",(0,r.kt)("inlineCode",{parentName:"p"},"src")," \u4e0b\u7684\u6587\u4ef6\u53d8\u5316\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"applyMethod('watchFileChange', 'src/config.*', async (event: string) => {\n  if (event === 'unlink' || event === 'add') {\n    // do something\n  }\n});\n")),(0,r.kt)("h2",{id:"\u63d2\u4ef6\u53c2\u6570"},"\u63d2\u4ef6\u53c2\u6570"),(0,r.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"build.json")," \u4e2d\u6307\u5b9a\u63d2\u4ef6\u53c2\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "plugins": [\n    ["build-plugin-foo", {\n      "type": "bar"\n    }]\n  ]\n}\n')),(0,r.kt)("p",null,"\u90a3\u4e48\u5728 build-plugin-foo \u91cc\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u4e2a\u53c2\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ context, log }, options) => {\n  const { type } = options;\n  log.info(type); // => bar\n}\n")),(0,r.kt)("h2",{id:"\u63d2\u4ef6\u901a\u4fe1"},"\u63d2\u4ef6\u901a\u4fe1"),(0,r.kt)("p",null,"\u63d2\u4ef6\u95f4\u9700\u8981\u8fdb\u884c\u901a\u4fe1\u7684\u573a\u666f\u8bc9\u6c42\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u540c\u63d2\u4ef6\u4e4b\u95f4\u9700\u8981\u77e5\u9053\u5f7c\u6b64\u7684\u5b58\u5728\u6765\u786e\u5b9a\u662f\u5426\u6267\u884c\u76f8\u5e94\u7684\u903b\u8f91"),(0,r.kt)("li",{parentName:"ol"},"\u591a\u4e2a\u63d2\u4ef6\u5171\u6709\u7684\u914d\u7f6e\u4fe1\u606f\u53ef\u4ee5\u62bd\u51fa\u6765\uff0c\u5728\u67d0\u4e2a\u63d2\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e")),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"setValue"),"\xa0\u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"getValue"),"\xa0\u4e24\u4e2aAPI\u6765\u5b9e\u73b0\uff0c\u5206\u522b\u7528\u4e8e\u6570\u636e\u7684\u5b58\u53d6\u3002"),(0,r.kt)("h3",{id:"setvalue"},"setValue"),(0,r.kt)("p",null,"\u7c7b\u578b\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"(key: string | number, value: any) => void"),"\uff0c\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// build-plugin-test\nmodule.exports = ({ setValue }) => {\n  setValue('key', 123);\n}\n")),(0,r.kt)("h3",{id:"getvalue"},"getValue"),(0,r.kt)("p",null,"\u7c7b\u578b\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"(key: string | number) => any"),"\uff0c\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getValue}) => {\n  const value = getValue('key'); // 123\n}\n")),(0,r.kt)("p",null,"\u540c\u65f6\u5728 icejs \u4e2d\u4e5f\u5185\u7f6e\u4e86\u51e0\u4e2a\u53d8\u91cf\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const projectType = getValue('PROJECT_TYPE'); // ts|js\nconst iceDirPath = getValue('TEMP_PATH');  // \u5bf9\u5e94 .ice \u7684\u8def\u5f84\n")),(0,r.kt)("h2",{id:"\u7c7b\u578b"},"\u7c7b\u578b"),(0,r.kt)("p",null,"\u63a5\u53e3\u7c7b\u578b\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u5f15\u5165\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { IPlugin } from 'build-scripts';\n")))}g.isMDXComponent=!0}}]);